apiVersion: v1
kind: Secret
metadata:
  name: grafana-ini
  namespace: monitoring
type: Opaque
stringData:
  grafana.ini: |
    [analytics]
      check_for_updates = true
    [grafana_net]
      url = https://grafana.net
    [log]
      mode = console
      level = debug
    [paths]
      data = /var/lib/grafana/
      logs = /var/log/grafana
      plugins = /var/lib/grafana/plugins
      provisioning = /etc/grafana/provisioning
    [server]
      domain = grafana.glythium.io
      root_url = https://grafana.glythium.io
    [auth.generic_oauth]
      enabled = true
      name = Keycloak
      allow_sign_up = true
      client_id = <CLIENT_ID>
      client_secret = <CLIENT_SECRET>
      scopes = openid email profile offline_access roles
      email_attribute_path = email
      login_attribute_path = username
      name_attribute_path = full_name
      auth_url = https://auth.glythium.io/realms/master/protocol/openid-connect/auth
      token_url = https://auth.glythium.io/realms/master/protocol/openid-connect/token
      api_url = https://auth.glythium.io/realms/master/protocol/openid-connect/userinfo
      role_attribute_strict = true
      role_attribute_path = contains(resource_access.grafana.roles[*], 'admin') && 'Admin' || contains(resource_access.grafana.roles[*], 'editor') && 'Editor' || 'Viewer'
